# Schema修复验证指南

**修复内容**: 更新Schema以支持完整的22种实体类型  
**验证时间**: 5分钟  
**前提**: 服务已启动 (http://localhost:8080)

## 快速验证步骤

### 1️⃣ 查看图谱列表

**操作**: 打开浏览器访问 http://localhost:8080/graphs

**预期结果**:
- ✅ 显示图谱卡片："智能驾驶研发体系"
- ✅ 统计数据正确：**53 节点，61 关系**

### 2️⃣ 进入图谱查看页

**操作**: 点击"智能驾驶研发体系"图谱卡片

**预期结果**:
- ✅ 页面正常加载
- ✅ 显示图谱视图（网络图）

### 3️⃣ 检查左侧边栏 - 统计信息

**位置**: 左侧边栏顶部"统计信息"卡片

**预期结果**:
- ✅ 节点数：**53**
- ✅ 关系数：**61**

### 4️⃣ 检查左侧边栏 - 实体类型

**位置**: 左侧边栏"实体类型"卡片

**预期结果**: 应显示22种实体类型，例如：

```
🔵 车型项目           1
🔵 车型定义           1
🟢 领域项目           3
🟣 PI规划             3
🌸 冲刺               3
🟠 Epic需求           3
🔴 特性需求           6
🟡 场景需求子条目      4
🟢 模块需求           4
🟢 开发任务           4
🔵 生命周期节点        3
🟠 基线               3
🟠 PRD文档            2
🔵 代码仓库           2
🔵 代码提交           2
🔵 构建               2
🔵 制品               2
🔵 部署               1
🟣 产品线             1
🟣 产品               1
🟣 特性资产           1
🟣 模块资产           1
```

**❌ 修复前**: 只显示2种类型（车型项目、系统需求）

**✅ 修复后**: 显示所有22种类型及准确数量

### 5️⃣ 检查左侧边栏 - 图例说明

**位置**: 左侧边栏底部"图例说明"卡片

**预期结果**:
- ✅ 显示22个图例项
- ✅ 每个图例显示颜色块 + 类型名称
- ✅ 鼠标hover显示类型描述（如果有）

**示例**:
```
🔵 车型项目         (整车项目，是最高层级的项目管理单元)
🔵 车型定义         (车型的详细定义信息)
🟢 领域项目         (车型项目下的领域级研发项目)
🟣 PI规划          (Program Increment规划，通常为6-12周)
🌸 冲刺            (敏捷开发的Sprint迭代，通常2-4周)
🟠 Epic需求        (原始需求，需求池中的最初形态)
...
```

### 6️⃣ 检查图谱视图 - 节点颜色

**位置**: 中间的图谱视图区域

**预期结果**:
- ✅ 节点显示多种不同的颜色（至少10种以上）
- ✅ 相同类型的节点颜色相同
- ✅ 节点大小和样式正确

**颜色映射**:
- 🔵 蓝色系: VehicleProject, VehicleModel, LifecycleNode, Repository, Commit, Build, Artifact, Deployment
- 🟢 绿色系: DomainProject, ModuleRequirement, Module, Task
- 🟣 紫色系: PIPlanning, ProductLine, Product, FeatureAsset, ModuleAsset
- 🌸 粉色系: Sprint
- 🟠 橙色系: Baseline, Epic, PRDDocument
- 🔴 红色系: FeatureRequirement
- 🟡 黄色系: SSTS

### 7️⃣ 检查节点详情

**操作**: 点击任意节点

**预期结果**:
- ✅ 右侧弹出节点详情面板
- ✅ 显示节点类型的中文标签（如"车型项目"、"领域项目"等）
- ✅ 显示节点属性和关联关系

### 8️⃣ 切换到仪表盘视图

**操作**: 点击顶部工具栏"仪表盘"按钮

**预期结果**:
- ✅ 显示节点类型分布柱状图
  - 应显示22种类型的柱状图
  - 每种类型显示中文标签
- ✅ 显示关系类型分布表格
  - 应显示所有关系类型
  - 显示数量、百分比、趋势图

### 9️⃣ 切换到表格视图

**操作**: 点击顶部工具栏"表格"按钮

**预期结果**:
- ✅ 表格中"类型"列显示中文标签
- ✅ 可以按类型筛选，应显示22种类型选项

### 🔟 切换到树形视图

**操作**: 点击顶部工具栏"树形"按钮

**预期结果**:
- ✅ 树形节点显示正确的颜色和图标
- ✅ 节点标签显示中文类型名称

## 验证清单

请逐项检查以下内容：

- [ ] 图谱列表显示正确的统计数据（53节点，61关系）
- [ ] 左侧边栏"统计信息"显示53节点，61关系
- [ ] 左侧边栏"实体类型"显示22种类型
- [ ] 每种实体类型的数量正确
- [ ] 左侧边栏"图例说明"显示22个图例项
- [ ] 图例显示正确的颜色和中文标签
- [ ] 图谱视图中节点显示多种颜色
- [ ] 节点详情显示正确的类型标签
- [ ] 仪表盘显示22种类型的柱状图
- [ ] 表格视图可以筛选22种类型
- [ ] 树形视图显示正确的节点样式

## 常见问题

### Q1: 仍然只显示2种类型

**可能原因**: 浏览器缓存

**解决方法**:
1. 强制刷新页面（Ctrl+F5 或 Cmd+Shift+R）
2. 清除浏览器缓存
3. 检查浏览器控制台是否有错误

### Q2: 节点颜色不正确

**可能原因**: Schema未正确加载

**解决方法**:
1. 检查后端日志：`tail -f logs/backend.log`
2. 确认看到 "✅ Schema加载成功"
3. 验证Schema API：`curl http://localhost:8090/api/v1/graph/schema | jq '.data.entityTypes | keys'`

### Q3: 部分类型缺失

**可能原因**: 数据文件不完整

**解决方法**:
1. 重新导入 `core-domain-data.json`
2. 验证数据API：`curl http://localhost:8090/api/v1/graphs/graph_f1590f04 | jq '.data.data.nodes | group_by(.type) | length'`

## API验证（可选）

如果前端显示异常，可以通过API直接验证：

### 验证Schema

```bash
curl -s http://localhost:8090/api/v1/graph/schema | jq '.data.entityTypes | keys'
```

**预期**: 返回23种实体类型名称列表

### 验证图谱数据

```bash
curl -s http://localhost:8090/api/v1/graphs/graph_f1590f04 | \
  jq '.data.data.nodes | group_by(.type) | map({type: .[0].type, count: length})'
```

**预期**: 返回22种类型及各自数量

### 验证实体类型分布

```bash
curl -s http://localhost:8090/api/v1/graphs/graph_f1590f04 | \
  jq '.data.data.nodes | group_by(.type) | map(.[0].type) | sort'
```

**预期**: 返回按字母排序的22种类型名称

## 验证成功标准

如果以上所有检查项都通过，则验证成功：

✅ **Schema修复成功**
✅ **所有22种实体类型正确识别**
✅ **前端UI正确显示所有类型和统计信息**
✅ **可以正常使用所有视图功能**

## 下一步

验证完成后，可以：

1. 测试创建新图谱功能
2. 测试导入其他数据文件
3. 测试数据编辑功能
4. 继续Phase 2开发（Schema版本管理）

---

**验证人员**: ___________  
**验证日期**: ___________  
**验证结果**: ⬜ 通过 / ⬜ 失败  
**备注**: ___________

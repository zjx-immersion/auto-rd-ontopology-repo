# Prompt评估与优化

**版本**: v1.0  
**日期**: 2026-01-18  
**基于**: Palantir Foundry Platform 和 AIP 实践

---

## 一、Prompt质量评估框架

### 1.1 评估维度

#### 维度1：完整性（Completeness）
- **覆盖度**：是否覆盖所有核心实体、关系、操作？
- **深度**：属性定义是否足够详细？
- **广度**：是否考虑了所有业务场景？

#### 维度2：准确性（Accuracy）
- **业务对齐**：是否准确反映业务领域？
- **类型正确性**：属性类型是否合适？
- **关系正确性**：关系定义是否准确？

#### 维度3：一致性（Consistency）
- **命名一致性**：命名约定是否一致？
- **结构一致性**：Schema结构是否一致？
- **格式一致性**：输出格式是否一致？

#### 维度4：可维护性（Maintainability）
- **文档完整性**：文档是否完整？
- **版本控制**：是否支持版本控制？
- **可扩展性**：是否易于扩展？

#### 维度5：工程化（Engineering）
- **可自动化**：是否支持自动化生成？
- **可验证**：是否支持自动化验证？
- **可集成**：是否易于集成到现有系统？

---

## 二、基于Palantir实践的评估标准

### 2.1 Foundry Platform标准

#### 对象类型评估
- ✅ **稳定实体**：对象类型应表示稳定的业务实体
- ✅ **清晰主键**：每个对象类型有稳定的主键
- ✅ **属性完整**：所有必要属性都有定义
- ✅ **关系明确**：通过Link Types连接，而非隐藏外键
- ✅ **文档完整**：有清晰的描述、所有者、刷新频率

#### 关系类型评估
- ✅ **语义明确**：关系名称反映业务含义
- ✅ **方向明确**：明确源对象和目标对象
- ✅ **基数定义**：定义基数约束（一对一、一对多、多对多）
- ✅ **属性支持**：关系本身可以包含属性
- ✅ **支持查询**：明确的关系支持查询和导航

#### 操作类型评估
- ✅ **参数定义**：操作的输入参数清晰
- ✅ **权限控制**：定义谁可以执行操作
- ✅ **副作用明确**：明确操作的副作用
- ✅ **审计支持**：支持操作审计

#### 函数/逻辑评估
- ✅ **业务规则**：封装业务规则和约束
- ✅ **模型集成**：支持ML/LLM模型集成
- ✅ **数据转换**：支持ETL和数据转换
- ✅ **外部集成**：支持外部系统集成

### 2.2 AIP标准

#### 决策中心设计
- ✅ **决策支持**：Schema支持业务决策
- ✅ **用例对齐**：与用例场景对齐
- ✅ **工作流集成**：支持工作流集成

#### 治理和安全性
- ✅ **权限模型**：定义权限和访问控制
- ✅ **数据血缘**：支持数据血缘追踪
- ✅ **审计支持**：支持操作审计
- ✅ **版本控制**：支持版本控制

#### 可扩展性
- ✅ **接口支持**：支持接口和多态
- ✅ **扩展机制**：支持未来扩展
- ✅ **向后兼容**：支持向后兼容

---

## 三、Prompt优化策略

### 3.1 基于评估结果的优化

#### 优化1：增强完整性
**问题**：Prompt可能遗漏某些重要元素

**优化方案**：
```markdown
## 增强：添加检查清单

在输出要求中添加：

### 完整性检查清单
- [ ] 所有核心实体都有定义
- [ ] 所有核心关系都有定义
- [ ] 所有核心操作都有定义（如需要）
- [ ] 所有业务规则都有体现
- [ ] 所有用例场景都有支持
```

#### 优化2：增强准确性
**问题**：生成的Schema可能不够准确

**优化方案**：
```markdown
## 增强：添加验证步骤

在Prompt中添加：

### 验证要求
1. 对照领域需求文档，确保所有实体和关系都有对应
2. 检查属性类型是否合适
3. 检查关系定义是否准确
4. 检查业务规则是否得到体现
```

#### 优化3：增强一致性
**问题**：命名和结构可能不一致

**优化方案**：
```markdown
## 增强：添加命名约定

在Prompt中添加：

### 命名约定
- 实体类型：PascalCase（如 Vehicle, DomainProject）
- 属性名称：camelCase（如 vehicleId, createdAt）
- 关系类型：snake_case（如 has_domain_project）
- 操作类型：PascalCase（如 CreateVehicle）
```

#### 优化4：增强可维护性
**问题**：文档可能不够完整

**优化方案**：
```markdown
## 增强：添加文档要求

在Prompt中添加：

### 文档要求
每个Schema元素必须包含：
- label（中文标签）
- description（详细描述）
- example（示例值，如适用）
- metadata（元数据，如所有者、版本等）
```

#### 优化5：增强工程化
**问题**：可能不支持自动化

**优化方案**：
```markdown
## 增强：添加自动化支持

在Prompt中添加：

### 自动化要求
- Schema必须符合JSON Schema规范
- 必须包含版本信息
- 必须包含变更历史
- 必须支持自动化验证
```

### 3.2 基于Palantir实践的优化

#### 优化A：添加决策中心思维
```markdown
## 增强：决策中心设计

在Prompt中添加：

### 决策中心要求
1. 识别业务决策点
2. 确保Schema支持这些决策
3. 定义支持决策的属性和关系
4. 定义支持决策的操作（如需要）
```

#### 优化B：添加治理要求
```markdown
## 增强：治理和安全性

在Prompt中添加：

### 治理要求
1. 定义权限模型（谁可以查看/修改）
2. 定义数据血缘（属性到数据源的映射）
3. 定义审计要求（操作审计）
4. 定义版本控制策略
```

#### 优化C：添加数据映射要求
```markdown
## 增强：数据源映射

在Prompt中添加：

### 数据映射要求
1. 每个对象类型应映射到数据源
2. 每个属性应标识权威数据源
3. 定义数据转换逻辑（如需要）
4. 定义数据质量要求
```

#### 优化D：添加操作类型支持
```markdown
## 增强：操作类型定义

在Prompt中添加：

### 操作类型要求
1. 识别关键业务操作
2. 定义操作参数
3. 定义操作权限
4. 定义操作副作用
```

#### 优化E：添加函数/逻辑支持
```markdown
## 增强：函数/逻辑定义

在Prompt中添加：

### 函数/逻辑要求
1. 识别业务规则
2. 定义计算函数（如需要）
3. 定义模型集成（如需要）
4. 定义外部集成（如需要）
```

---

## 四、优化后的完整Prompt模板

### 4.1 主Prompt（优化版）

```markdown
# 任务：基于领域需求生成OAG知识图谱Schema（优化版）

## 角色定义
你是一位经验丰富的本体建模专家，精通Palantir Foundry的本体论实践和知识图谱工程。你的任务是基于提供的领域需求，生成符合OAG（Ontology-Aware Graph）标准的Schema定义。

## 核心原则

### 1. 决策中心设计
- 理解业务决策点
- 确保Schema支持这些决策
- 定义支持决策的属性和关系

### 2. 治理优先
- 定义权限模型
- 定义数据血缘
- 定义审计要求
- 定义版本控制

### 3. 稳定实体
- 对象类型应表示稳定的业务实体
- 避免在名称中嵌入版本
- 版本化内容而非类名

### 4. 明确关系
- 使用关系类型而非隐藏外键
- 明确关系的语义和方向
- 定义关系的属性（如需要）

### 5. 可扩展性
- 使用接口支持多态
- 支持未来扩展
- 保持向后兼容

## 输入要求

[同原版，但增强以下部分]

### 增强：决策点识别
请明确标识：
- **关键决策点**：用户需要做什么决策？
- **决策所需信息**：决策需要哪些信息？
- **决策流程**：决策如何执行？

### 增强：数据源映射
如果已有数据源，请提供：
- 数据源名称和类型
- Schema定义
- **权威性标识**：哪个数据源是哪个属性的权威来源
- **数据质量**：数据质量评估
- **更新频率**：数据更新频率

### 增强：治理要求
请明确：
- **权限要求**：谁可以查看/修改哪些对象？
- **审计要求**：需要审计哪些操作？
- **版本要求**：是否需要版本控制？

## 输出要求

[同原版，但增强以下部分]

### 增强：Schema结构

必须包含以下完整结构：

```json
{
  "version": "2.0.0",
  "name": "{domain}-schema-v2",
  "description": "{领域描述}",
  "domain": "{领域名称}",
  "created": "{日期}",
  "entityTypes": { ... },
  "relationTypes": { ... },
  "interfaces": { ... },
  "actionTypes": { ... },
  "functions": { ... },
  "governance": {
    "permissions": { ... },
    "lineage": { ... },
    "audit": { ... }
  },
  "metadata": {
    "author": "...",
    "lastUpdated": "...",
    "versionHistory": [...]
  }
}
```

### 增强：数据映射

每个对象类型必须包含：

```json
{
  "{EntityName}": {
    "backingDatasets": [
      {
        "name": "{datasetName}",
        "authoritativeFor": ["{property1}", "{property2}"],
        "updateFrequency": "{frequency}",
        "dataQuality": "{quality}"
      }
    ]
  }
}
```

### 增强：治理定义

必须包含：

```json
{
  "governance": {
    "permissions": {
      "{EntityName}": {
        "viewers": ["{role1}", "{role2}"],
        "editors": ["{role1}"]
      }
    },
    "lineage": {
      "{EntityName}.{property}": {
        "source": "{datasetName}",
        "transformation": "{logic}"
      }
    },
    "audit": {
      "enabled": true,
      "trackActions": ["{action1}", "{action2}"]
    }
  }
}
```

## 验证要求

### 完整性检查
- [ ] 所有核心实体都有定义
- [ ] 所有核心关系都有定义
- [ ] 所有核心操作都有定义（如需要）
- [ ] 所有业务规则都有体现
- [ ] 所有用例场景都有支持
- [ ] 所有决策点都有支持

### 准确性检查
- [ ] 准确反映业务领域
- [ ] 属性类型正确
- [ ] 关系定义正确
- [ ] 业务规则正确

### 一致性检查
- [ ] 命名约定一致
- [ ] 类型定义一致
- [ ] 描述格式一致

### 治理检查
- [ ] 权限定义完整
- [ ] 数据血缘定义完整
- [ ] 审计要求明确
- [ ] 版本控制策略明确

## 输出格式

请按以下顺序输出：

1. **Schema定义**（JSON代码块）
2. **Schema文档**（Markdown代码块）
3. **数据映射文档**（Markdown代码块）
4. **治理文档**（Markdown代码块）
5. **验证报告**（Markdown代码块）
6. **改进建议**（如有）

---

请开始分析提供的领域需求，并生成Schema定义。
```

---

## 五、Prompt迭代优化流程

### 5.1 评估-优化循环

```
Step 1: 使用Prompt生成Schema
  ↓
Step 2: 评估Schema质量（5个维度）
  ↓
Step 3: 识别问题和改进点
  ↓
Step 4: 优化Prompt
  ↓
Step 5: 重新生成Schema
  ↓
Step 6: 对比评估
  ↓
Step 7: 迭代优化（如需要）
```

### 5.2 优化记录模板

```markdown
# Prompt优化记录

## 优化日期
2026-01-18

## 优化原因
- 问题1：生成的Schema缺少治理定义
- 问题2：数据映射不够详细
- 问题3：验证检查不够全面

## 优化内容
1. 添加治理要求部分
2. 增强数据映射要求
3. 添加验证检查清单

## 优化效果
- 完整性：7/10 → 9/10
- 准确性：8/10 → 9/10
- 可维护性：6/10 → 8/10

## 下一步
- 继续优化操作类型定义
- 增强函数/逻辑定义
```

---

## 六、Prompt质量评分表

### 6.1 评分标准

| 维度 | 评分标准 | 权重 |
|------|---------|------|
| **完整性** | 0-10分 | 25% |
| **准确性** | 0-10分 | 25% |
| **一致性** | 0-10分 | 15% |
| **可维护性** | 0-10分 | 15% |
| **工程化** | 0-10分 | 20% |

### 6.2 评分示例

**Prompt版本1.0**：
- 完整性：7/10
- 准确性：8/10
- 一致性：7/10
- 可维护性：6/10
- 工程化：7/10
- **总分**：7.1/10

**Prompt版本1.1（优化后）**：
- 完整性：9/10
- 准确性：9/10
- 一致性：8/10
- 可维护性：8/10
- 工程化：8/10
- **总分**：8.4/10

---

## 七、持续改进建议

### 7.1 短期改进（1-2周）

1. **增强示例**：添加更多领域示例
2. **增强验证**：添加自动化验证脚本
3. **增强文档**：完善文档模板

### 7.2 中期改进（1-2个月）

1. **多领域测试**：在不同领域测试Prompt
2. **用户反馈**：收集用户反馈并优化
3. **工具集成**：集成到现有工具链

### 7.3 长期改进（3-6个月）

1. **AI模型微调**：基于实际使用数据微调
2. **自动化流程**：建立完整的自动化流程
3. **知识库建设**：建立领域知识库

---

**下一步**：参见 `05-SYSTEM_REQUIREMENTS.md` 了解系统需要支持的功能。
